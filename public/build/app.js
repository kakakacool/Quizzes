function delete_cookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}$(".logout").on("click",function(){delete_cookie("username"),delete_cookie("email"),delete_cookie("_id"),window.location.replace("/")}),$("#addTests").on("click",function(e){e.preventDefault();var t=$("#testsName").val(),n=$("#testsImage").val().split("\\");n="/images/"+n[n.length-1],""==t||""==n?($("#createTests").addClass("alert-danger"),$("#createTests").html("Fill all fields")):$.post("/admin",{name:t,url:n},function(e){e.success?($("#createTests").removeClass("alert-danger"),$("#createTests").addClass("alert-success"),$("#createTests").html(e.text),$("#addTests").addClass("disabled"),setTimeout(function(){window.location="/admin"},500)):($("#createTests").addClass("alert-danger"),$("#createTests").html(e.text))})});var test="";$(".add").on("click",function(){test=$(this).attr("name")}),$("#saveQuestion").on("click",function(){for(var children=$(".questionsForm").children(),n=children.length,questions=[],i=0;n>i;i++){var questionText=$(children[i]).find("textarea"),answers=$(children[i]).find("input"),obj={text:"",answers:[],test:""};obj.text=$(questionText).val();for(var j=0;j<answers.length-1;j++)obj.answers.push($(answers[j]).val());obj.answers.push(eval($(answers[answers.length-1]).val())?Number($(answers[answers.length-1]).val()):-1),obj.test=test,questions.push(obj)}$.post("/admin/question",{arr:JSON.stringify(questions)},function(e){e.success?($("#questionResult").removeClass("alert-danger"),$("#questionResult").addClass("alert-success"),$("#questionResult").html(e.text),$("#addTests").addClass("disabled"),setTimeout(function(){window.location="/admin"},1e3)):($("#questionResult").addClass("alert-danger"),$("#questionResult").html(e.text),setTimeout(function(){window.location="/admin"},1e3))})}),$(".addAnswer").on("click",function(e){e.preventDefault(),$(this).prev().before("<input class='answer form-control' placeholder='Enter answer' type='text'>")}),$("#addQuestion").on("click",function(e){e.preventDefault(),$(".questionsForm").append("<div class='form-group row' style='border:1px solid orange;border-radius:5px'><div class='col-md-10 col-md-offset-1'><div class='form-group'><label for='name'>Question:</label><textarea class='form-control questionText' placeholder='Enter question'></textarea></div><div class='form-group answers'><label for='answers'>Answers:</label><input class='answer form-control' placeholder='Enter answer' type='text'><input class='answer form-control' placeholder='Enter answer' type='text'><input class='answer form-control' placeholder='Enter correct answer' type='number'><button class='btn btn-default addAnswer'>add answer</button></div></div></div>"),$(".addAnswer").unbind("click"),$(".addAnswer").on("click",function(e){e.preventDefault(),$(this).prev().before("<input class='answer form-control' placeholder='Enter answer' type='text'>")})}),$(".change").on("click",function(){var e=$(this).attr("name");$.get("/admin/question",{test:e},function(e){if(e.success){var t=e.arr;$(".changeForm").html("");for(var n=0;n<t.length;n++){var s="",a=t[n].answers;s+="<div class='form-group row' style='border:1px solid orange;border-radius:5px'><div class='col-md-10 col-md-offset-1'><div class='form-group'><label for='name'>Question:</label><textarea class='form-control questionText'>"+t[n].text+"</textarea></div><div class='form-group answers'><label for='answers'>Answers:</label>";for(var r=0;r<a.length-1;r++)s+="<input class='answer form-control' value='"+a[r]+"' type='text'>";s+="<input class='answer form-control' value='"+a[a.length-1]+"' type='text'>",s+="<button class='btn btn-warning changeQ ' name='"+t[n]._id+"' data-loading-text='Saving...'>change</button><button class='btn btn-danger deleteQ ' name='"+t[n]._id+"'>delete</button></div></div></div>",$(".changeForm").append(s)}$(".changeQ").on("click",function(e){e.preventDefault();var t=$(this);t.button("loading");for(var n=t.attr("name"),s=t.parent().parent(),a=s.find("textarea").val(),r=s.find("input"),o=[],l=0;l<r.length;l++)o.push($(r[l]).val());var i={};i._id=n,i.text=a,i.answers=o,$.ajax({url:"/admin/question",type:"PUT",data:{obj:JSON.stringify(i)},success:function(){alert("question changed")},error:function(e){alert(e)}}).always(function(){t.button("reset")})}),$(".deleteQ").on("click",function(e){e.preventDefault();var t=$(this);t.button("loading");var n=t.attr("name");$.ajax({url:"/admin/question",type:"DELETE",data:{_id:n},success:function(){t.closest(".row").remove()},error:function(e){alert(e)}}).always(function(){t.button("reset")})}),$(".changeQuestions").removeClass("alert-danger"),$(".changeQuestions").addClass("alert-success"),$(".changeQuestions").html(e.data)}else $(".changeQuestions").addClass("alert-danger"),$(".changeQuestions").html(e.text)})}),$(".delete").on("click",function(){$.ajax({url:"/admin/"+$(this).attr("name"),type:"DELETE",success:function(){location.reload()}})});
$("#login").on("click",function(e){e.preventDefault();{var a=$("#email").val().trim(),t=$("#password").val().trim(),r=$(".indexForm").find("input");r.filter(function(){return""==$(this).val().trim()}).popover("show").css("border","1px solid tomato").focus()}(a||t)&&$.post("/users",{email:a,password:t},function(e){e.success?window.location="admin@gmail.com"==a?"/admin":"/users":($(".page-header").addClass("alert-warning",2e3,"easeOutBounce"),$(".page-header h3").html(e.text))})}),$(".respond").on("click",function(e){e.preventDefault()}),$("#register").on("click",function(e){e.preventDefault();var a=$(".fullname").val().trim(),t=$(".username").val().trim(),r=$(".email").val().trim(),n=$(".password").val().trim(),i=$(".tani").find("input");i.filter(function(){return""==$(this).val().trim()}).popover("show"),n&&r&&t&&a&&$.post("/",{fullname:a,username:t,email:r,password:n},function(e){e.success?(i.val(""),$(".registration").modal("hide"),$(".page-header").addClass("alert-success",1500,"easeOutBounce"),$(".page-header h3").html(e.text+" please log in")):($(".modal-header").addClass("alert-warning",1500,"easeOutBounce"),$(".modal-header h3").html(e.text))})});
function delete_cookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function bindi(){$(".answers p").on("mouseover",function(){this.style.border="3px solid DodgerBlue"}).on("mouseout",function(){this.style.border="3px solid Lavender"}).on("click",function(){selected=Number($(this).attr("name")),$("#next").removeClass("disabled"),$(this).siblings().css("border-color","Lavender"),$(this).siblings().bind("mouseout",function(){this.style.border="3px solid Lavender"}),this.style.border="3px solid DodgerBlue",$(this).unbind("mouseout")})}$(".logout").on("click",function(){delete_cookie("username"),delete_cookie("email"),delete_cookie("_id"),window.location.replace("/")});var qArr,k=0,n,count,array=[],test,time,timeInterval;$(".startQuiz").on("click",function(){time=0,test=$(this).attr("name"),$.get("/admin/question",{test:test},function(e){e.success?(timeInterval=setInterval(function(){time++,$(".dro").html(" "+time)},1e3),qArr=_.shuffle(e.arr),n=e.arr.length,count=0,nexti(),bindi(),$("#next").on("click",function(){$(this).addClass("disabled"),selected==qArr[k-1].answers[qArr[k-1].answers.length-1]&&count++,nexti(),bindi()})):$(".modal-title").html(e.text)})});var nexti=function(){$(".answers").text(""),$(".question").text(qArr[k].text);for(var e=0;e<qArr[k].answers.length-1;e++)$(".answers").append($("<p name='"+(e+1)+"'></p>").text(qArr[k].answers[e]));k==n-1&&($("#next").addClass("btn-danger"),$("#next").unbind("click"),$("#next").html("Finish"),$("#next").on("click",function(){selected==qArr[k-1].answers[qArr[k-1].answers.length-1]&&count++,$(".answers").text("");var e=Math.ceil(count/n*100);$.post("/users/scores",{test:test,score:e,time:time},function(e){$(".question").text("YOUR SCORE IS "+e+" %"),time=0,clearInterval(timeInterval)}),$("#next").remove()})),k++},selected;$(".close").click(function(){location.reload(),time=0}),$(".closed").click(function(){location.reload(),time=0}),$("li a").on("click",function(e){e.preventDefault();var t=$(this).html().trim();$("#dLabel").html(t+" Ranking <span class='caret'>");var n=$("tbody");n.html(""),$.get("/users/rank",{test:t},function(e){if(e.success)for(var t=e.arr,s=0;s<t.length;s++)n.append("<tr><td>"+(s+1)+"</td><td>"+t[s].takerUsername+"</td><td>"+t[s].score+"</td><td>"+t[s].time+"</td></tr>");else alert("Test Ranking not found")})});